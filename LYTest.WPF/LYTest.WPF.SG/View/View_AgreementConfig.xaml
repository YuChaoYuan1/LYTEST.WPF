<basemodel:DockControlDisposable  
             xmlns:basemodel="clr-namespace:LYTest.WPF.SG.Model" 
             x:Class="LYTest.WPF.SG.View.View_AgreementConfig"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:LYTest.WPF.SG.View" xmlns:Controls1="clr-namespace:LYTest.WPF.SG.Controls"
             mc:Ignorable="d" 
              Loaded="DockControlDisposable_Loaded"
             Foreground="{DynamicResource 字体颜色标准}"
             d:DesignHeight="600" d:DesignWidth="1200">
    <basemodel:DockControlDisposable.Resources>
        <XmlDataProvider x:Key="ProviderMeterProtocol"
                         Source="/LYTest.WPF.SG;component/ConfigData/AgreementConfig.xml"/>
        <XmlDataProvider x:Key="ProviderCarrierProtocol"
                         Source="/LYTest.WPF.SG;component/ConfigData/CarrierConfig.xml"/>
    </basemodel:DockControlDisposable.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="200"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>

        <Border Background="{DynamicResource 窗口背景色}" CornerRadius="10" Margin="10">
            <Grid >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="40" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <TextBlock Grid.ColumnSpan="2" Text="电能表通信协议配置" FontWeight="Bold" FontSize="18" HorizontalAlignment="Center" />

                <StackPanel Grid.Row="1" Orientation="Vertical" Margin="10"  DataContext="{Binding Source={StaticResource ProviderMeterProtocol}}">
                    <ListBox x:Name="listBox" 
                         BorderBrush="Transparent"
                         Background="Transparent"
                         DataContext="{Binding XPath=/DgnProtocol/Protocols}" 
				         ItemsSource="{Binding XPath=R}"
                         SelectedIndex="0"
                         HorizontalAlignment="Left" SelectionChanged="ListBox_SelectionChanged">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" >
                                    <TextBlock Text="■" VerticalAlignment="Center" FontSize="18" Margin="0,0,0,3"/>
                                    <Controls1:EditBox Text="{Binding XPath=@Name,Mode=TwoWay}" HorizontalAlignment="Left" VerticalAlignment="Center" 
                                           Width="125" Margin="8,1,0,1"/>
                                    <Button HorizontalAlignment="Right" Click="Del_Click" Margin="3" Name="btn_Del" ToolTip="删除当前协议" VerticalAlignment="Center"  >
                                        <Image Width="18" Source="{DynamicResource 删除}"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>

                    </ListBox>
                    <Button Click="Add_Click" HorizontalAlignment="Right" ToolTip="添加新协议" Margin="1" MinHeight="40" MinWidth="40" >
                        <Image Width="18" Source="{DynamicResource 添加}"/>
                    </Button>
                </StackPanel>

                <Border Grid.Column="1" Grid.Row="1" Background="White" Margin="0,0,5,5" CornerRadius="10,10,10,10" >
                    <StackPanel Margin="10" DataContext="{Binding SelectedItem, ElementName=listBox}">
                        <StackPanel.Resources>
                            <Style TargetType="ListBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBox">
                                            <StackPanel IsItemsHost="True"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="ItemTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <StackPanel Margin="3"
                                Orientation="Horizontal">
                                                <TextBlock Width="70"
                                           TextAlignment="Left"
                                           VerticalAlignment="Center"
                                           Margin="3" Text="{Binding StringFormat=\{0\}:, XPath=@Display}"/>
                                                <TextBox Width="130" Text="{Binding XPath=@Password,Mode=TwoWay}"/>
                                                <TextBlock Text="等级:"
                                           Margin="25,3,3,3"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Right"
                                           Width="30"/>
                                                <TextBox Width="60"
                                         VerticalAlignment="Center" Text="{Binding XPath=@Class,Mode=TwoWay}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </StackPanel.Resources>

                        <StackPanel Orientation="Horizontal">
                            <CheckBox  x:Name="checkBox" Content="有编程建"  Width="80"   Margin="3"
                          HorizontalAlignment="Right"  IsChecked="{Binding XPath=HaveProgrammingkey,Mode=TwoWay}"/>
                            <CheckBox Margin="3"  Width="120"   HorizontalAlignment="Right"   Content="数据域包含密码" IsChecked="{Binding XPath=DataFieldPassword,Mode=TwoWay}"/>
                            <CheckBox Margin="3"    Width="120"    HorizontalAlignment="Right"  Content="写块操作加AA" IsChecked="{Binding XPath=BlockAddAA,Mode=TwoWay}"/>
                        </StackPanel>


                        <StackPanel  Orientation="Horizontal" Margin="3">
                            <TextBlock Text="通信参数:"    Margin="3" Width="60"/>
                            <Controls1:ControlEnumComboBox    Width="100"    EnumName="SerialPortPara"  Style="{DynamicResource StyleComboBox}"
                                                      SelectedValue="{Binding XPath=Setting,Mode=TwoWay}"/>
                            <TextBlock Text="登录用户:" Margin="3"  VerticalAlignment="Center" Width="60"/>
                            <TextBox Width="100" Text="{Binding XPath=UserID,Mode=TwoWay}"/>
                        </StackPanel>

                        <StackPanel Margin="3" Orientation="Horizontal">
                            <TextBlock Text="验证方式:"   Margin="3" VerticalAlignment="Center"  Width="60"/>
                            <Controls1:ControlEnumComboBox  Width="100"   Style="{DynamicResource StyleComboBox}" VerticalAlignment="Center"  
                                                    EnumName="Authentication" SelectedIndex="{Binding XPath=VerifyPasswordType,Mode=TwoWay}"/>
                            <TextBlock Text="唤醒符数:"  Margin="3" TextWrapping="WrapWithOverflow"  VerticalAlignment="Center"  Width="60"/>
                            <TextBox   Width="100"    VerticalAlignment="Center" Text="{Binding XPath=FECount,Mode=TwoWay}"/>
                        </StackPanel>
                        <StackPanel Margin="3"  Orientation="Horizontal">
                            <TextBlock Text="日期格式:"    Margin="3"    VerticalAlignment="Center" Width="60"/>
                            <Controls1:ControlEnumComboBox Width="100"    Style="{DynamicResource StyleComboBox}"  EnumName="TimeFormat" 
                                                   SelectedValue="{Binding XPath=DateTimeFormat,Mode=TwoWay}"   ToolTip="{Binding SelectedValue, RelativeSource={RelativeSource Self}}"/>
                            <TextBlock Text="周日格式:"  Margin="3"
                               VerticalAlignment="Center"  Width="60"/>
                            <Controls1:ControlEnumComboBox  Width="100"  Style="{DynamicResource StyleComboBox}" 
                                                    EnumName="SundayId" SelectedValue="{Binding XPath=SundayIndex,Mode=TwoWay}"/>
                        </StackPanel>
                        <StackPanel Margin="3,10,3,10" Orientation="Horizontal">
                            <TextBlock Text="尖:"
                               Margin="10,3,3,3"
                               VerticalAlignment="Center"
                               Width="20"/>
                            <Controls1:ControlEnumComboBox   Width="50"  EnumName="TimeSlot"
                                                     Style="{DynamicResource StyleComboBox}" 
                                                     SelectedValue="{Binding XPath=FeiLvId/@Jian,Mode=TwoWay}"/>
                            <TextBlock Text="峰:" Margin="10,3,3,3" VerticalAlignment="Center" Width="20"/>
                            <Controls1:ControlEnumComboBox  Width="50"   EnumName="TimeSlot" 
                                                    Style="{DynamicResource StyleComboBox}" 
                                                    SelectedValue="{Binding XPath=FeiLvId/@Feng,Mode=TwoWay}"/>
                            <TextBlock Text="平:" Margin="10,3,3,3" VerticalAlignment="Center" Width="20"/>
                            <Controls1:ControlEnumComboBox  Width="50"   EnumName="TimeSlot" 
                                                    Style="{DynamicResource StyleComboBox}" 
                                                    SelectedValue="{Binding XPath=FeiLvId/@Ping,Mode=TwoWay}"/>
                            <TextBlock Text="谷:" Margin="10,3,3,3" VerticalAlignment="Center" Width="20"/>
                            <Controls1:ControlEnumComboBox   Width="50"   EnumName="TimeSlot" 
                                                     Style="{DynamicResource StyleComboBox}" 
                                                     SelectedValue="{Binding XPath=FeiLvId/@Gu,Mode=TwoWay}"/>
                            <TextBlock Text="深谷:" Margin="5,3,3,3" VerticalAlignment="Center" Width="28"/>
                            <Controls1:ControlEnumComboBox   Width="50"   EnumName="TimeSlot" 
                                                     Style="{DynamicResource StyleComboBox}" 
                                                     SelectedValue="{Binding XPath=FeiLvId/@ShenGu,Mode=TwoWay}"/>

                        </StackPanel>

                        <StackPanel Margin="3,10,3,10" Orientation="Horizontal">
                            <TextBlock Text="电量小数位:" Margin="10,3,3,3" VerticalAlignment="Center" Width="70"/>
                            <Controls1:ControlEnumComboBox Width="110" EnumName="MeterDecimalDigitsType"
                        Style="{DynamicResource StyleComboBox}" SelectedValue="{Binding XPath=DecimalDigits,Mode=TwoWay}"/>

                        </StackPanel>
                        <StackPanel Margin="3,10,3,10" Orientation="Horizontal">
                            <TextBlock Text="使用协议:" Margin="10,3,3,3" VerticalAlignment="Center" Width="60"/>
                            <Controls1:ControlEnumComboBox Width="120" EnumName="MeterProtocolType"
                        Style="{DynamicResource StyleComboBox}" SelectedValue="{Binding XPath=ClassName,Mode=TwoWay}"/>

                        </StackPanel>

                        <Grid Height="5" Margin="0,3" HorizontalAlignment="Stretch" Background="{DynamicResource 窗口背景深色}"/>
                        <ListBox ItemsSource="{Binding XPath=OperationsHaveKey/Operation}" Margin="3"
                    Visibility="{Binding IsChecked, Converter={StaticResource BoolToVisibilityConverter}, ElementName=checkBox}"/>
                        <ListBox ItemsSource="{Binding XPath=OperationsNoKey/Operation}" Margin="3,10,3,10"
                    Visibility="{Binding IsChecked, Converter={StaticResource NotBoolToVisibilityConverter}, ElementName=checkBox}" />
                    </StackPanel>

                </Border>

                <Button Grid.Column="1" Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="10"
                        Click="Btn_Save" ToolTip="保存协议配置信息" >
                    <Image Width="32" Height="32" Source="{DynamicResource 保存}"/>
                </Button>
            </Grid>
        </Border>

        <Border  Grid.Column="1" Background="{DynamicResource 窗口背景色}" CornerRadius="10" Margin="10">
            <Grid >
                <Grid.RowDefinitions>
                    <RowDefinition Height="40" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.ColumnSpan="2" Text="载波协议配置" FontWeight="Bold" FontSize="18" HorizontalAlignment="Center" />
                <StackPanel Grid.Row="1" Orientation="Vertical"  DataContext="{Binding Source={StaticResource ProviderCarrierProtocol}}" Margin="10">
                    <ListBox x:Name="list_ZB" BorderBrush="Transparent" Background="Transparent"
                         DataContext="{Binding XPath=/CarrierProtocol/Protocols}" ItemsSource="{Binding XPath=R}" SelectedIndex="0" >
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" >
                                    <TextBlock Text="■" VerticalAlignment="Center" FontSize="18" Margin="0,0,0,3"/>
                                    <Controls1:EditBox Margin="5,3,0,3"	Text="{Binding XPath=@Name,Mode=TwoWay}" HorizontalAlignment="Left" VerticalAlignment="Center" Width="120"/>
                                    <Button HorizontalAlignment="Right" Click="ZB_Btn_Del" Margin="3" ToolTip="删除当前协议"  VerticalAlignment="Center">
                                        <Image Width="18" Source="{DynamicResource 删除}"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>

                    </ListBox>
                    <Button Click="ZB_Btn_Add" HorizontalAlignment="Right" ToolTip="添加新协议" Margin="1" MinHeight="40" MinWidth="40" >
                        <Image Width="18" Source="{DynamicResource 添加}"/>
                    </Button>
                </StackPanel>

                <Border Grid.Column="1" Grid.Row="1" Background="White" Margin="0,0,5,5" CornerRadius="10,10,10,10" >
                    <StackPanel Grid.Row="1" Grid.ColumnSpan="1" HorizontalAlignment="Left"  Margin="10 20 0 0" Grid.Column="1"   DataContext="{Binding SelectedItem, ElementName=list_ZB}">
                        <StackPanel Orientation="Horizontal">
                            <CheckBox x:Name="chk_route" Content="路由标识" Width="80" Margin="3" HorizontalAlignment="Right" IsChecked="{Binding XPath=IsRoute,Mode=TwoWay}"/>
                            <CheckBox x:Name="chk_broadband" Content="宽带载波" Width="80" Margin="3" HorizontalAlignment="Right" IsChecked="{Binding XPath=IsBroad,Mode=TwoWay}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="3">

                            <TextBlock Text="通信参数:" Margin="3" Width="60"/>
                            <Controls1:ControlEnumComboBox Width="100" EnumName="SerialPortPara"
                                                   Style="{DynamicResource StyleComboBox}" 
                                                   SelectedValue="{Binding XPath=BaudRate,Mode=TwoWay}"/>
                            <TextBlock Text="通讯介质:" Margin="3" VerticalAlignment="Center" Width="60"/>

                            <Controls1:ControlEnumComboBox Width="100"   EnumName="ConnectMode"
                                                   Style="{DynamicResource StyleComboBox}" 
                                                   SelectedValue="{Binding XPath=CarrierType,Mode=TwoWay}"/>
                        </StackPanel>
                        <StackPanel Margin="3" Orientation="Horizontal">
                            <TextBlock Text="抄表器类型:" Margin="3" VerticalAlignment="Center" Width="60"/>
                            <Controls1:ControlEnumComboBox Width="100"  Style="{DynamicResource StyleComboBox}"
                                    VerticalAlignment="Center" EnumName="CarrierType" SelectedIndex="{Binding XPath=RdType,Mode=TwoWay}"/>
                            <TextBlock Text="通讯端口:" Margin="3" TextWrapping="WrapWithOverflow" VerticalAlignment="Center"  Width="60"/>
                            <TextBox Width="100" VerticalAlignment="Center" Text="{Binding XPath=Comm,Mode=TwoWay}"/>

                        </StackPanel>
                        <StackPanel Orientation="Horizontal"   Margin="3" >
                            <TextBlock Text="命令延时:" Margin="3" VerticalAlignment="Center"  Width="60"/>
                            <TextBox  Width="100"   VerticalAlignment="Center"  Text="{Binding XPath=CmdTime,Mode=TwoWay}"/>
                            <TextBlock Text="字节延时:" Margin="3" VerticalAlignment="Center"  Width="60"/>
                            <TextBox  Width="100"   VerticalAlignment="Center"  Text="{Binding XPath=ByteTime,Mode=TwoWay}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
                <Button Grid.Row="1" Grid.Column="1" Margin="10"
                        HorizontalAlignment="Right" VerticalAlignment="Bottom"
                        Click="ZB_Btn_Save" ToolTip="保存载波协议配置信息" >
                    <Image Width="32" Height="32" Source="{DynamicResource 保存}"/>
                </Button>
            </Grid>

        </Border>


    </Grid>
</basemodel:DockControlDisposable> 
                                                                                                    